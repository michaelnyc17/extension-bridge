let FirefoxAPI={BASE_URL:"https://addons.mozilla.org/api/v5/addons/search/",cache:new Map,timeout:5e3,async search(t,e={}){if(!t)return[];var r=this.getCacheKey(t,e);if(this.cache.has(r))return this.cache.get(r);t=new URLSearchParams({q:t,app:"firefox",type:"extension",sort:"relevance",...e});try{let e=new AbortController;var a,s,i=setTimeout(()=>e.abort(),this.timeout),n=await fetch(this.BASE_URL+"?"+t.toString(),{signal:e.signal});if(clearTimeout(i),n.ok)return a=await n.json(),s=this.parseResults(a),this.cache.set(r,s),s;throw new Error("API returned "+n.status)}catch(e){return console.error("Firefox API error:",e),[]}},extractString(e){return e?"string"==typeof e?e:"object"==typeof e?e.en||e["en-US"]||Object.values(e)[0]||"":String(e):""},parseResults(e){return e&&e.results?e.results.map(e=>({name:this.extractString(e.name),slug:e.slug||"",description:this.extractString(e.summary),rating:e.ratings?.average||0,users:e.average_daily_users||0,url:e.url||`https://addons.mozilla.org/firefox/addon/${e.slug}/`,homepage:this.extractString(e.homepage?.url),developer:e.authors?.[0]?.name||"",icon:e.icon_url||"",categories:e.categories?.firefox||[],lastUpdated:e.last_updated||"",guid:e.guid||""})):[]},async searchWithStrategies(e){var t=[],t=(e.name&&t.push(this.search(e.name)),e.shortName&&e.shortName!==e.name&&t.push(this.search(e.shortName)),await Promise.all(t)),t=this.deduplicateResults([...t[0],...t[1]||[]]);if(!(3<=t.length)&&e.description){var e=StringSimilarity.extractKeywords(e.description).slice(0,3).join(" ");if(e)return e=await this.search(e),this.deduplicateResults([...t,...e])}return t},deduplicateResults(e){let t=new Set;return e.filter(e=>!t.has(e.slug)&&(t.add(e.slug),!0))},getCacheKey(e,t){return e+"_"+JSON.stringify(t)},clearCache(){this.cache.clear()}};